@if (errorMessage()) {
  <div class="toast">{{ errorMessage() }}</div>
}

<header class="header">
  <div class="header-text">
    <h1>Todos</h1>
    <p>Stay organized, one task at a time</p>
  </div>
  <button class="theme-toggle" (click)="toggleDarkMode()" aria-label="Toggle dark mode">
    {{ darkMode() ? '&#9788;' : '&#9789;' }}
  </button>
</header>

<div class="add-form">
  <input
    type="text"
    [ngModel]="newTitle()"
    (ngModelChange)="newTitle.set($event)"
    placeholder="What needs to be done?"
    (keyup.enter)="add()"
    aria-label="New todo title"
  />
  <textarea
    rows="3"
    [ngModel]="newDescription()"
    (ngModelChange)="newDescription.set($event)"
    placeholder="Add a short description (optional)"
    aria-label="New todo description"
  ></textarea>
  <div class="priority-selector" role="group" aria-label="Select priority">
    @for (p of PRIORITIES; track p) {
      <label class="priority-option">
        <input
          type="radio"
          name="priority"
          [value]="p"
          [(ngModel)]="newPriority"
          [attr.aria-label]="'Priority: ' + getPriorityLabel(p)"
        />
        <span class="priority-label">{{ getPriorityLabel(p) }}</span>
      </label>
    }
  </div>
  <button class="btn-primary" (click)="add()" [disabled]="!newTitle().trim()">Add</button>
</div>

<nav class="filters" aria-label="Filter todos">
  @for (f of ['all', 'active', 'completed']; track f) {
    <button
      class="filter-btn"
      [class.active]="filter() === f"
      (click)="setFilter($any(f))"
    >{{ f | titlecase }}</button>
  }
</nav>

<ul class="todo-list">
  @for (todo of filteredTodos(); track todo.id) {
    <li class="todo-item" [class.completed]="todo.isCompleted">
      <label class="todo-checkbox">
        <input
          type="checkbox"
          [checked]="todo.isCompleted"
          (change)="toggle(todo.id)"
        />
        <span class="checkmark"></span>
      </label>
      <div class="todo-content">
        <span class="todo-title">{{ todo.title }}</span>
        @if (todo.description) {
          <span class="todo-description">{{ todo.description }}</span>
        }
      </div>
      <span class="priority-badge" [attr.data-priority]="todo.priority.toLowerCase()">
        {{ getPriorityLabel(todo.priority) }}
      </span>
      <button class="btn-delete" (click)="deleteTodo(todo.id)" aria-label="Delete todo">
        &times;
      </button>
    </li>
  } @empty {
    <li class="empty-state">
      @if (filter() === 'all') {
        <span class="empty-icon">&#9744;</span>
        <span>No todos yet. Add one above!</span>
      } @else if (filter() === 'active') {
        <span class="empty-icon">&#10003;</span>
        <span>All caught up! No active todos.</span>
      } @else {
        <span class="empty-icon">&#9744;</span>
        <span>No completed todos yet.</span>
      }
    </li>
  }
</ul>
